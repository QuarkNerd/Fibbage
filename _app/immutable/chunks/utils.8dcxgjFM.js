import{g as d,s as f,d as l,f as i,r as R}from"./SubmitText.svelte_svelte_type_style_lang.bXODe_Eg.js";function b(r,n){return r.users.includes(n)?"USERNAME_TAKEN":r.currentRoundNumber>-1?"GAME_ALREADY_STARTED":{users:[...r.users,n]}}function p(r){return r.users.length<2?"NOT_ENOUGH_PLAYERS":r.currentRoundNumber>-1?"GAME_ALREADY_STARTED":{currentRoundNumber:0}}function m(r,n,t,e){if(r.currentRoundNumber!==e||!r.users.includes(n)||r.currentRoundNumber<0)return"INVALID";const u=r.rounds[r.currentRoundNumber];return u.type!=="Fibbage"?"NOT_FIBBAGE":u.fibs.find(s=>s.user===n)?"FIB_ALREADY_SUBMITTED":(u.fibs.push({user:n,fib:t}),{rounds:r.rounds})}function E(r,n,t){const e=n.user;if(r.currentRoundNumber!==t||!r.users.includes(e)||r.currentRoundNumber<0)return"INVALID";const u=r.rounds[r.currentRoundNumber];return u.guesses.find(s=>s.user===e)?"GUESS_ALREADY_SUBMITTED":(u.guesses.push(n),{rounds:r.rounds})}function A(r,n,t){if(r.currentRoundNumber!==t||!r.users.includes(n)||r.currentRoundNumber<0)return"INVALID";const e=r.rounds[r.currentRoundNumber];if(e.resultConfirmed.find(s=>s===n))return"ALREADY_CONFIRMED";e.resultConfirmed.push(n);const u=e.resultConfirmed.length===r.users.length?t+1:t;return{rounds:r.rounds,currentRoundNumber:u}}const h=100,N=25;function S(r){const n=Object.fromEntries(r.users.map(t=>[t,0]));return r.rounds.forEach(t=>D(n,t)),Object.entries(n).sort((t,e)=>e[1]-t[1])}function D(r,n){if(n.type==="Fibbage"){n.guesses.forEach(t=>{if(t.correct){r[t.user]+=h;return}n.fibs.filter(e=>e.fib===t.value).forEach(e=>r[e.user]+=N)});return}throw new Error("Not implemented")}async function T(r,n){const t=a(r);try{if((await d(t)).exists())return!1}catch{}return f(t,{name:r,currentRoundNumber:-1,users:[],rounds:n}),!0}async function _(r,n){return await o(b,r,n)}async function I(r){return await o(p,r)}async function U(r,n,t,e){return await o(m,r,n,t,e)}async function C(r,n,t){return await o(E,r,n,t)}async function L(r,n,t){return await o(A,r,n,t)}async function o(r,n,...t){const e=a(n);return await R(i,async u=>{const s=await y(u,e),c=r(s,...t);return typeof c=="string"?c:(u.update(e,c),"SUCCESS")})}async function y(r,n){const t=await r.get(n);if(!t.exists())throw"Document does not exist!";return t.data()}function a(r){return l(i,"private-games",r)}function F(r,n){const t=[];for(;t.length<n;){const e=Math.floor(Math.random()*r.length);t.push(r[e]),r.splice(e,1)}return t}function G(r,n){const t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(n)),t.setAttribute("download",r),t.style.display="none",document.body.appendChild(t),t.click(),document.body.removeChild(t)}export{C as a,S as b,T as c,G as d,L as e,U as f,_ as l,F as p,I as s};
